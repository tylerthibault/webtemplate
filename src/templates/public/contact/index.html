{% extends "bases/public.html" %}

{% block title %}Contact - Creative Portfolio{% endblock %}

{% block content %}
<!-- Contact Header -->
<section class="contact-header bg-primary text-white py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold mb-3">Get in Touch</h1>
                <p class="lead">Have a project in mind? Let's discuss how I can help bring your ideas to life.</p>
            </div>
        </div>
    </div>
</section>

<!-- Contact Form Section -->
<section class="contact-form py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <!-- Success Message -->
                <div id="successMessage" class="alert alert-success alert-dismissible fade d-none" role="alert">
                    <strong>Success!</strong> Your message has been sent. You will receive a confirmation email shortly.
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Error Message -->
                <div id="errorMessage" class="alert alert-danger alert-dismissible fade d-none" role="alert">
                    <strong>Error!</strong> <span id="errorText"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <div class="card shadow">
                    <div class="card-body p-4">
                        <h3 class="card-title mb-4">Send Me a Message</h3>
                        
                        <form id="contactForm">
                            <!-- CSRF Token -->
                            <input type="hidden" name="csrf_token" id="csrfToken" value="{{ csrf_token() }}">
                            
                            <!-- Name Field -->
                            <div class="mb-3">
                                <label for="name" class="form-label">Your Name *</label>
                                <input 
                                    type="text" 
                                    class="form-control" 
                                    id="name" 
                                    name="name" 
                                    required 
                                    minlength="2" 
                                    maxlength="100"
                                    placeholder="Enter your full name">
                                <div class="invalid-feedback">
                                    Please provide your name (2-100 characters).
                                </div>
                            </div>

                            <!-- Email Field -->
                            <div class="mb-3">
                                <label for="email" class="form-label">Email Address *</label>
                                <input 
                                    type="email" 
                                    class="form-control" 
                                    id="email" 
                                    name="email" 
                                    required 
                                    maxlength="120"
                                    placeholder="your.email@example.com">
                                <div class="invalid-feedback">
                                    Please provide a valid email address.
                                </div>
                            </div>

                            <!-- Subject Field -->
                            <div class="mb-3">
                                <label for="subject" class="form-label">Subject *</label>
                                <input 
                                    type="text" 
                                    class="form-control" 
                                    id="subject" 
                                    name="subject" 
                                    required 
                                    minlength="5" 
                                    maxlength="200"
                                    placeholder="What is this regarding?">
                                <div class="invalid-feedback">
                                    Please provide a subject (5-200 characters).
                                </div>
                            </div>

                            <!-- Message Field -->
                            <div class="mb-3">
                                <label for="message" class="form-label">Message *</label>
                                <textarea 
                                    class="form-control" 
                                    id="message" 
                                    name="message" 
                                    rows="6" 
                                    required 
                                    minlength="10" 
                                    maxlength="2000"
                                    placeholder="Tell me about your project or inquiry..."></textarea>
                                <div class="invalid-feedback">
                                    Please provide a message (10-2000 characters).
                                </div>
                                <div class="form-text">
                                    <span id="charCount">0</span> / 2000 characters
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                    <span id="submitText">Send Message</span>
                                    <span id="submitSpinner" class="spinner-border spinner-border-sm d-none" role="status">
                                        <span class="visually-hidden">Sending...</span>
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Info Section -->
<section class="contact-info bg-light py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-md-4 text-center">
                <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
                        <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"/>
                    </svg>
                </div>
                <h5>Email</h5>
                <p class="text-muted">Response within 24 hours</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-clock" viewBox="0 0 16 16">
                        <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                    </svg>
                </div>
                <h5>Working Hours</h5>
                <p class="text-muted">Mon - Fri: 9:00 AM - 6:00 PM</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-chat-dots" viewBox="0 0 16 16">
                        <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                        <path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
                    </svg>
                </div>
                <h5>Let's Talk</h5>
                <p class="text-muted">Free initial consultation</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Character counter
    const messageField = document.getElementById('message');
    const charCount = document.getElementById('charCount');
    
    messageField.addEventListener('input', function() {
        charCount.textContent = this.value.length;
    });

    // Form submission handler
    document.getElementById('contactForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Validate form
        if (!this.checkValidity()) {
            e.stopPropagation();
            this.classList.add('was-validated');
            return;
        }
        
        // Disable submit button and show spinner
        const submitBtn = document.getElementById('submitBtn');
        const submitText = document.getElementById('submitText');
        const submitSpinner = document.getElementById('submitSpinner');
        
        submitBtn.disabled = true;
        submitText.classList.add('d-none');
        submitSpinner.classList.remove('d-none');
        
        // Collect form data
        const formData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            subject: document.getElementById('subject').value,
            message: document.getElementById('message').value,
            csrf_token: document.getElementById('csrfToken').value
        };
        
        try {
            const response = await fetch('/contact', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Show success message
                const successMsg = document.getElementById('successMessage');
                successMsg.classList.remove('d-none');
                successMsg.classList.add('show');
                
                // Hide error message if visible
                document.getElementById('errorMessage').classList.add('d-none');
                
                // Reset form
                this.reset();
                this.classList.remove('was-validated');
                charCount.textContent = '0';
                
                // Scroll to success message
                successMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                // Show error message
                const errorMsg = document.getElementById('errorMessage');
                const errorText = document.getElementById('errorText');
                
                if (data.errors) {
                    // Display validation errors
                    const errorList = Object.values(data.errors).join(', ');
                    errorText.textContent = errorList;
                } else {
                    errorText.textContent = data.message || 'An error occurred. Please try again.';
                }
                
                errorMsg.classList.remove('d-none');
                errorMsg.classList.add('show');
                
                // Hide success message if visible
                document.getElementById('successMessage').classList.add('d-none');
                
                // Scroll to error message
                errorMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        } catch (error) {
            console.error('Contact form error:', error);
            
            const errorMsg = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = 'Network error. Please check your connection and try again.';
            errorMsg.classList.remove('d-none');
            errorMsg.classList.add('show');
        } finally {
            // Re-enable submit button
            submitBtn.disabled = false;
            submitText.classList.remove('d-none');
            submitSpinner.classList.add('d-none');
        }
    });
</script>
{% endblock %}
